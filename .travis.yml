#jdk: oraclejdk11
#env:
#  global:
#    - PATH=$HOME/.local/bin:$PATH
#
#matrix:
#  include:
#    - if: commit_message =~ /android/
#      env: TEST_SUITE="TravisTest"
#      language: android
#      os: linux
#
#    - if: commit_message =~ /android/
#      env: TEST_SUITE="TravisTest1"
#      language: android
#      os: linux
#
#    - if: commit_message =~ /ios/
#      env: TEST_SUITE="TravisTest1"
#      os: osx
#      osx_image: xcode10.1
#      language: java
#
#    - if: commit_message =~ /ios/
#      env: TEST_SUITE="TravisTest1"
#      os: osx
#      osx_image: xcode10.1
#      language: java
#
#android:
#  licenses:
#    - 'android-sdk-preview-license-.+'
#    - 'android-sdk-license-.+'
#    - 'google-gdk-license-.+'
#  components:
#    - tools
#    - tools
#    - platform-tools
#    - extra-google-google_play_services
#    - extra-google-m2repository
#    - extra-android-m2repository
#    - build-tools-28.0.3
#    - android-25
#    - sys-img-arm64-v8a-google_apis-25
#
#install:
#  - |
#    if [[ $TRAVIS_OS_NAME == "linux" ]]; then
#      sudo apt-get update
#      sudo apt-get install build-essential libssl-dev
#      sudo curl https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash
#      source ~/.profile
#      nvm --version
#      nvm install 10.15.3
#      nvm use 10.15.3
#      node -v
#      npm -v
#      npm install -g appium@1.9.1
#    fi
#
#  - |
#    if [[ $TRAVIS_OS_NAME == "osx" ]]; then
#      brew update
#      brew install awscli
#      npm install -g appium@1.9.1
#      brew cask install google-chrome
#    fi
#
#before_script:
#  - |
#    if [[ $TRAVIS_OS_NAME == "linux" ]]; then
#      echo no | android create avd --force -n Pixel_XL_API_25 --abi arm64-v8a -t 1 --tag google_apis
#      emulator -avd Pixel_XL_API_25 -no-window &
#      android-wait-for-emulator
#      adb shell input keyevent 82
#    fi
#
#  - |
#    if [[ $TRAVIS_OS_NAME == "linux" ]]; then
#    adb -P 5037 -s emulator-5554 install /home/travis/.nvm/versions/node/v10.15.3/lib/node_modules/appium/node_modules/appium-uiautomator2-server/apks/appium-uiautomator2-server-v1.18.0.apk
#    fi
#
#script:
#  - |
#    if [[ $TRAVIS_OS_NAME == "linux" ]]; then
#    adb -P 5037 -s emulator-5554 install /home/travis/.nvm/versions/node/v10.15.3/lib/node_modules/appium/node_modules/appium-uiautomator2-server/apks/appium-uiautomator2-server-debug-androidTest.apk
#    fi
##  - appium --log-level error &
#  - appium &
#  - mvn clean verify -Dtags=$TEST_SUITE

jdk: oraclejdk11
env:
  global:
    - PATH=$HOME/.local/bin:$PATH
variables:
  ANDROID_COMPILE_SDK: "26"
  ANDROID_BUILD_TOOLS: "26.0.0"
  ANDROID_SDK_TOOLS: "26.0.2"

matrix:
  include:
    - if: commit_message =~ /android/
      env: TEST_SUITE="TravisTest"
      language: android
      os: linux

    - if: commit_message =~ /android/
      env: TEST_SUITE="TravisTest1"
      language: android
      os: linux

    - if: commit_message =~ /ios/
      env: TEST_SUITE="TravisTest1"
      os: osx
      osx_image: xcode10.1
      language: java

    - if: commit_message =~ /ios/
      env: TEST_SUITE="TravisTest1"
      os: osx
      osx_image: xcode10.1
      language: java

install:
  - |
    if [[ $TRAVIS_OS_NAME == "linux" ]]; then
      sudo apt-get update
      sudo apt-get install build-essential libssl-dev
      sudo curl https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash
      source ~/.profile
      nvm --version
      nvm install 10.15.3
      nvm use 10.15.3
      node -v
      npm -v
      npm install -g appium@1.9.1
    fi

  - |
    if [[ $TRAVIS_OS_NAME == "osx" ]]; then
      brew update
      brew install awscli
      npm install -g appium@1.9.1
      brew cask install google-chrome
    fi

before_script:
  - apt-get --quiet update --yes
  - apt-get --quiet install --yes wget tar unzip lib32stdc++6 lib32z1
  - wget --quiet --output-document=android-sdk.tgz https://dl.google.com/android/android-sdk_r${ANDROID_SDK_TOOLS}-linux.tgz
  - tar --extract --gzip --file=android-sdk.tgz
  - echo y | android-sdk-linux/tools/android --silent update sdk --no-ui --all --filter android-${ANDROID_COMPILE_SDK}
  - echo y | android-sdk-linux/tools/android --silent update sdk --no-ui --all --filter platform-tools
  - echo y | android-sdk-linux/tools/android --silent update sdk --no-ui --all --filter build-tools-${ANDROID_BUILD_TOOLS}
  - echo y | android-sdk-linux/tools/android --silent update sdk --no-ui --all --filter extra-android-m2repository
  - echo y | android-sdk-linux/tools/android --silent update sdk --no-ui --all --filter extra-google-google_play_services
  - echo y | android-sdk-linux/tools/android --silent update sdk --no-ui --all --filter extra-google-m2repository
  - export ANDROID_HOME=$PWD/android-sdk-linux
  - export PATH=$PATH:$PWD/android-sdk-linux/platform-tools/
  - |
    if [[ $TRAVIS_OS_NAME == "linux" ]]; then
      echo y | android-sdk-linux/tools/android --silent update sdk --no-ui --all --filter sys-img-x86-google_apis-${ANDROID_COMPILE_SDK}
      echo no | android-sdk-linux/tools/android create avd -n test -t android-${ANDROID_COMPILE_SDK} --abi google_apis/x86
      android-sdk-linux/tools/emulator64-x86 -avd test -no-window -no-audio &
      ./android-wait-for-emulator
      adb shell input keyevent 82
    fi

  - |
    if [[ $TRAVIS_OS_NAME == "linux" ]]; then
    adb -P 5037 -s emulator-5554 install /home/travis/.nvm/versions/node/v10.15.3/lib/node_modules/appium/node_modules/appium-uiautomator2-server/apks/appium-uiautomator2-server-v1.18.0.apk
    fi

script:
  - |
    if [[ $TRAVIS_OS_NAME == "linux" ]]; then
    adb -P 5037 -s emulator-5554 install /home/travis/.nvm/versions/node/v10.15.3/lib/node_modules/appium/node_modules/appium-uiautomator2-server/apks/appium-uiautomator2-server-debug-androidTest.apk
    fi
  #  - appium --log-level error &
  - appium &
  - mvn clean verify -Dtags=$TEST_SUITE